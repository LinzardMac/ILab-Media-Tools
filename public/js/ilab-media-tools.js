!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return"undefined"==typeof t}function s(t,e){var s=[];return i(e)&&s.push(e),s.slice.apply(t,s)}function a(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function n(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==b.protocol||i[2]!==b.hostname||i[3]!==b.port)}function o(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function r(t){return t?' crossOrigin="'+t+'"':""}function h(t,i){var e;return t.naturalWidth&&!ft?i(t.naturalWidth,t.naturalHeight):(e=document.createElement("img"),e.onload=function(){i(this.width,this.height)},void(e.src=t.src))}function l(t){var e=[],s=t.rotate,a=t.scaleX,n=t.scaleY;return i(a)&&i(n)&&e.push("scale("+a+","+n+")"),i(s)&&e.push("rotate("+s+"deg)"),e.length?e.join(" "):"none"}function p(t,i){var e,s,a=bt(t.degree)%180,n=(a>90?180-a:a)*Math.PI/180,o=Ct(n),r=yt(n),h=t.width,l=t.height,p=t.aspectRatio;return i?(e=h/(r+o/p),s=e/p):(e=h*r+l*o,s=h*o+l*r),{width:e,height:s}}function d(e,s){var a,n,o,r=t("<canvas>")[0],h=r.getContext("2d"),l=0,d=0,c=s.naturalWidth,u=s.naturalHeight,g=s.rotate,m=s.scaleX,f=s.scaleY,v=i(m)&&i(f)&&(1!==m||1!==f),x=i(g)&&0!==g,w=x||v,b=c*bt(m||1),C=u*bt(f||1);return v&&(a=b/2,n=C/2),x&&(o=p({width:b,height:C,degree:g}),b=o.width,C=o.height,a=b/2,n=C/2),r.width=b,r.height=C,w&&(l=-c/2,d=-u/2,h.save(),h.translate(a,n)),v&&h.scale(m,f),x&&h.rotate(g*Math.PI/180),h.drawImage(e,Bt(l),Bt(d),Bt(c),Bt(u)),w&&h.restore(),r}function c(i){var e=i.length,s=0,a=0;return e&&(t.each(i,function(t,i){s+=i.pageX,a+=i.pageY}),s/=e,a/=e),{pageX:s,pageY:a}}function u(t,i,e){var s,a="";for(s=i,e+=i;e>s;s++)a+=Dt(t.getUint8(s));return a}function g(t){var i,e,s,a,n,o,r,h,l,p,d=new I(t),c=d.byteLength;if(255===d.getUint8(0)&&216===d.getUint8(1))for(l=2;c>l;){if(255===d.getUint8(l)&&225===d.getUint8(l+1)){r=l;break}l++}if(r&&(e=r+4,s=r+10,"Exif"===u(d,e,4)&&(o=d.getUint16(s),n=18761===o,(n||19789===o)&&42===d.getUint16(s+2,n)&&(a=d.getUint32(s+4,n),a>=8&&(h=s+a)))),h)for(c=d.getUint16(h,n),p=0;c>p;p++)if(l=h+12*p+2,274===d.getUint16(l,n)){l+=8,i=d.getUint16(l,n),ft&&d.setUint16(l,1,n);break}return i}function m(t){var i,e=t.replace(J,""),s=atob(e),a=s.length,n=new y(a),o=new k(n);for(i=0;a>i;i++)o[i]=s.charCodeAt(i);return n}function f(t){var i,e=new k(t),s=e.length,a="";for(i=0;s>i;i++)a+=Dt(e[i]);return"data:image/jpeg;base64,"+B(a)}function v(i,e){this.$element=t(i),this.options=t.extend({},v.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var x=t(window),w=t(document),b=window.location,C=window.navigator,y=window.ArrayBuffer,k=window.Uint8Array,I=window.DataView,B=window.btoa,D="cropper",P="cropper-modal",S="cropper-hide",$="cropper-hidden",_="cropper-invisible",L="cropper-move",T="cropper-crop",M="cropper-disabled",O="cropper-bg",z="mousedown touchstart pointerdown MSPointerDown",W="mousemove touchmove pointermove MSPointerMove",X="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",Y="wheel mousewheel DOMMouseScroll",j="dblclick",H="load."+D,R="error."+D,E="resize."+D,A="build."+D,U="built."+D,V="cropstart."+D,F="cropmove."+D,N="cropend."+D,Q="crop."+D,q="zoom."+D,K=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,Z=/^data\:/,J=/^data\:([^\;]+)\;base64,/,G=/^data\:image\/jpeg.*;base64,/,tt="preview",it="action",et="e",st="w",at="s",nt="n",ot="se",rt="sw",ht="ne",lt="nw",pt="all",dt="crop",ct="move",ut="zoom",gt="none",mt=t.isFunction(t("<canvas>")[0].getContext),ft=C&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(C.userAgent),vt=Number,xt=Math.min,wt=Math.max,bt=Math.abs,Ct=Math.sin,yt=Math.cos,kt=Math.sqrt,It=Math.round,Bt=Math.floor,Dt=String.fromCharCode;v.prototype={constructor:v,init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&mt&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var s=t.Event(i,e);return this.$element.trigger(s),s},load:function(i){var e,s,a=this.options,r=this.$element;if(i&&(r.one(A,a.build),!this.trigger(A).isDefaultPrevented())){if(this.url=i,this.image={},!a.checkOrientation||!y)return this.clone();if(e=t.proxy(this.read,this),Z.test(i))return G.test(i)?e(m(i)):this.clone();s=new XMLHttpRequest,s.onerror=s.onabort=t.proxy(function(){this.clone()},this),s.onload=function(){e(this.response)},a.checkCrossOrigin&&n(i)&&r.prop("crossOrigin")&&(i=o(i)),s.open("get",i),s.responseType="arraybuffer",s.send()}},read:function(t){var i,e,s,a=this.options,n=g(t),o=this.image;if(n>1)switch(this.url=f(t),n){case 2:e=-1;break;case 3:i=-180;break;case 4:s=-1;break;case 5:i=90,s=-1;break;case 6:i=90;break;case 7:i=90,e=-1;break;case 8:i=-90}a.rotatable&&(o.rotate=i),a.scalable&&(o.scaleX=e,o.scaleY=s),this.clone()},clone:function(){var i,e,s=this.options,a=this.$element,h=this.url,l="";s.checkCrossOrigin&&n(h)&&(l=a.prop("crossOrigin"),l?i=h:(l="anonymous",i=o(h))),this.crossOrigin=l,this.crossOriginUrl=i,this.$clone=e=t("<img"+r(l)+' src="'+(i||h)+'">'),this.isImg?a[0].complete?this.start():a.one(H,t.proxy(this.start,this)):e.one(H,t.proxy(this.start,this)).one(R,t.proxy(this.stop,this)).addClass(S).insertAfter(a)},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off(R,this.stop),i=e),h(i[0],t.proxy(function(i,e){t.extend(this.image,{naturalWidth:i,naturalHeight:e,aspectRatio:i/e}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var i,e,s,a=this.options,n=this.$element,o=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=n.parent(),this.$cropper=i=t(v.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(o),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=s=e.find(".cropper-face"),n.addClass($).after(i),this.isImg||o.removeClass(S),this.initPreview(),this.bind(),a.aspectRatio=wt(0,a.aspectRatio)||NaN,a.viewMode=wt(0,xt(3,It(a.viewMode)))||0,a.autoCrop?(this.isCropped=!0,a.modal&&this.$dragBox.addClass(P)):e.addClass($),a.guides||e.find(".cropper-dashed").addClass($),a.center||e.find(".cropper-center").addClass($),a.cropBoxMovable&&s.addClass(L).data(it,pt),a.highlight||s.addClass(_),a.background&&i.addClass(O),a.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass($),this.setDragMode(a.dragMode),this.render(),this.isBuilt=!0,this.setData(a.data),n.one(U,a.built),setTimeout(t.proxy(function(){this.trigger(U),this.trigger(Q,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass($),i.removeClass($),s.css(this.container={width:wt(e.width(),vt(t.minContainerWidth)||200),height:wt(e.height(),vt(t.minContainerHeight)||100)}),i.addClass($),s.removeClass($)},initCanvas:function(){var i,e=this.options.viewMode,s=this.container,a=s.width,n=s.height,o=this.image,r=o.naturalWidth,h=o.naturalHeight,l=90===bt(o.rotate),p=l?h:r,d=l?r:h,c=p/d,u=a,g=n;n*c>a?3===e?u=n*c:g=a/c:3===e?g=a/c:u=n*c,i={naturalWidth:p,naturalHeight:d,aspectRatio:c,width:u,height:g},i.oldLeft=i.left=(a-u)/2,i.oldTop=i.top=(n-g)/2,this.canvas=i,this.isLimited=1===e||2===e,this.limitCanvas(!0,!0),this.initialImage=t.extend({},o),this.initialCanvas=t.extend({},i)},limitCanvas:function(t,i){var e,s,a,n,o=this.options,r=o.viewMode,h=this.container,l=h.width,p=h.height,d=this.canvas,c=d.aspectRatio,u=this.cropBox,g=this.isCropped&&u;t&&(e=vt(o.minCanvasWidth)||0,s=vt(o.minCanvasHeight)||0,r&&(r>1?(e=wt(e,l),s=wt(s,p),3===r&&(s*c>e?e=s*c:s=e/c)):e?e=wt(e,g?u.width:0):s?s=wt(s,g?u.height:0):g&&(e=u.width,s=u.height,s*c>e?e=s*c:s=e/c)),e&&s?s*c>e?s=e/c:e=s*c:e?s=e/c:s&&(e=s*c),d.minWidth=e,d.minHeight=s,d.maxWidth=1/0,d.maxHeight=1/0),i&&(r?(a=l-d.width,n=p-d.height,d.minLeft=xt(0,a),d.minTop=xt(0,n),d.maxLeft=wt(0,a),d.maxTop=wt(0,n),g&&this.isLimited&&(d.minLeft=xt(u.left,u.left+u.width-d.width),d.minTop=xt(u.top,u.top+u.height-d.height),d.maxLeft=u.left,d.maxTop=u.top,2===r&&(d.width>=l&&(d.minLeft=xt(0,a),d.maxLeft=wt(0,a)),d.height>=p&&(d.minTop=xt(0,n),d.maxTop=wt(0,n))))):(d.minLeft=-d.width,d.minTop=-d.height,d.maxLeft=l,d.maxTop=p))},renderCanvas:function(t){var i,e,s=this.canvas,a=this.image,n=a.rotate,o=a.naturalWidth,r=a.naturalHeight;this.isRotated&&(this.isRotated=!1,e=p({width:a.width,height:a.height,degree:n}),i=e.width/e.height,i!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=o,s.naturalHeight=r,n%180&&(e=p({width:o,height:r,degree:n}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=xt(wt(s.width,s.minWidth),s.maxWidth),s.height=xt(wt(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=xt(wt(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=xt(wt(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,s=this.canvas,a=this.image;a.rotate&&(e=p({width:s.width,height:s.height,degree:a.rotate,aspectRatio:a.aspectRatio},!0)),t.extend(a,e?{width:e.width,height:e.height,left:(s.width-e.width)/2,top:(s.height-e.height)/2}:{width:s.width,height:s.height,left:0,top:0}),this.$clone.css({width:a.width,height:a.height,marginLeft:a.left,marginTop:a.top,transform:l(a)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,s=i.aspectRatio,a=vt(i.autoCropArea)||.8,n={width:e.width,height:e.height};s&&(e.height*s>e.width?n.height=n.width/s:n.width=n.height*s),this.cropBox=n,this.limitCropBox(!0,!0),n.width=xt(wt(n.width,n.minWidth),n.maxWidth),n.height=xt(wt(n.height,n.minHeight),n.maxHeight),n.width=wt(n.minWidth,n.width*a),n.height=wt(n.minHeight,n.height*a),n.oldLeft=n.left=e.left+(e.width-n.width)/2,n.oldTop=n.top=e.top+(e.height-n.height)/2,this.initialCropBox=t.extend({},n)},limitCropBox:function(t,i){var e,s,a,n,o=this.options,r=o.aspectRatio,h=this.container,l=h.width,p=h.height,d=this.canvas,c=this.cropBox,u=this.isLimited;t&&(e=vt(o.minCropBoxWidth)||0,s=vt(o.minCropBoxHeight)||0,e=xt(e,l),s=xt(s,p),a=xt(l,u?d.width:l),n=xt(p,u?d.height:p),r&&(e&&s?s*r>e?s=e/r:e=s*r:e?s=e/r:s&&(e=s*r),n*r>a?n=a/r:a=n*r),c.minWidth=xt(e,a),c.minHeight=xt(s,n),c.maxWidth=a,c.maxHeight=n),i&&(u?(c.minLeft=wt(0,d.left),c.minTop=wt(0,d.top),c.maxLeft=xt(l,d.left+d.width)-c.width,c.maxTop=xt(p,d.top+d.height)-c.height):(c.minLeft=0,c.minTop=0,c.maxLeft=l-c.width,c.maxTop=p-c.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,a=this.cropBox;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=xt(wt(a.width,a.minWidth),a.maxWidth),a.height=xt(wt(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.oldLeft=a.left=xt(wt(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=xt(wt(a.top,a.minTop),a.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(it,a.width===e&&a.height===s?ct:pt),this.$cropBox.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(Q,this.getData())},initPreview:function(){var i,e=r(this.crossOrigin),s=e?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$clone2=i=t("<img"+e+' src="'+s+'">'),this.$viewBox.html(i),this.$preview.each(function(){var i=t(this);i.data(tt,{width:i.width(),height:i.height(),html:i.html()}),i.html("<img"+e+' src="'+s+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data(tt);i.css({width:e.width,height:e.height}).html(e.html).removeData(tt)})},preview:function(){var i=this.image,e=this.canvas,s=this.cropBox,a=s.width,n=s.height,o=i.width,r=i.height,h=s.left-e.left-i.left,p=s.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:o,height:r,marginLeft:-h,marginTop:-p,transform:l(i)}),this.$preview.each(function(){var e=t(this),s=e.data(tt),d=s.width,c=s.height,u=d,g=c,m=1;a&&(m=d/a,g=n*m),n&&g>c&&(m=c/n,u=a*m,g=c),e.css({width:u,height:g}).find("img").css({width:o*m,height:r*m,marginLeft:-h*m,marginTop:-p*m,transform:l(i)})}))},bind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.on(V,i.cropstart),t.isFunction(i.cropmove)&&e.on(F,i.cropmove),t.isFunction(i.cropend)&&e.on(N,i.cropend),t.isFunction(i.crop)&&e.on(Q,i.crop),t.isFunction(i.zoom)&&e.on(q,i.zoom),s.on(z,t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&s.on(Y,t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&s.on(j,t.proxy(this.dblclick,this)),w.on(W,this._cropMove=a(this.cropMove,this)).on(X,this._cropEnd=a(this.cropEnd,this)),i.responsive&&x.on(E,this._resize=a(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.off(V,i.cropstart),t.isFunction(i.cropmove)&&e.off(F,i.cropmove),t.isFunction(i.cropend)&&e.off(N,i.cropend),t.isFunction(i.crop)&&e.off(Q,i.crop),t.isFunction(i.zoom)&&e.off(q,i.zoom),s.off(z,this.cropStart),i.zoomable&&i.zoomOnWheel&&s.off(Y,this.wheel),i.toggleDragModeOnDblclick&&s.off(j,this.dblclick),w.off(W,this._cropMove).off(X,this._cropEnd),i.responsive&&x.off(E,this._resize)},resize:function(){var i,e,s,a=this.options.restore,n=this.$container,o=this.container;!this.isDisabled&&o&&(s=n.width()/o.width,1===s&&n.height()===o.height||(a&&(i=this.getCanvasData(),e=this.getCropBoxData()),this.render(),a&&(this.setCanvasData(t.each(i,function(t,e){i[t]=e*s})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*s})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(T)?this.setDragMode(ct):this.setDragMode(dt))},wheel:function(i){var e=i.originalEvent||i,s=vt(this.options.wheelZoomRatio)||.1,a=1;this.isDisabled||(i.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(t.proxy(function(){this.wheeling=!1},this),50),e.deltaY?a=e.deltaY>0?1:-1:e.wheelDelta?a=-e.wheelDelta/120:e.detail&&(a=e.detail>0?1:-1),this.zoom(-a*s,i)))},cropStart:function(i){var e,s,a=this.options,n=i.originalEvent,o=n&&n.touches,r=i;if(!this.isDisabled){if(o){if(e=o.length,e>1){if(!a.zoomable||!a.zoomOnTouch||2!==e)return;r=o[1],this.startX2=r.pageX,this.startY2=r.pageY,s=ut}r=o[0]}if(s=s||t(r.target).data(it),K.test(s)){if(this.trigger(V,{originalEvent:n,action:s}).isDefaultPrevented())return;i.preventDefault(),this.action=s,this.cropping=!1,this.startX=r.pageX||n&&n.pageX,this.startY=r.pageY||n&&n.pageY,s===dt&&(this.cropping=!0,this.$dragBox.addClass(P))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,a=s&&s.touches,n=t,o=this.action;if(!this.isDisabled){if(a){if(i=a.length,i>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;n=a[1],this.endX2=n.pageX,this.endY2=n.pageY}n=a[0]}if(o){if(this.trigger(F,{originalEvent:s,action:o}).isDefaultPrevented())return;t.preventDefault(),this.endX=n.pageX||s&&s.pageX,this.endY=n.pageY||s&&s.pageY,this.change(n.shiftKey,o===ut?t:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(P,this.isCropped&&this.options.modal)),this.action="",this.trigger(N,{originalEvent:i,action:e}))},change:function(t,i){var e,s,a=this.options,n=a.aspectRatio,o=this.action,r=this.container,h=this.canvas,l=this.cropBox,p=l.width,d=l.height,c=l.left,u=l.top,g=c+p,m=u+d,f=0,v=0,x=r.width,w=r.height,b=!0;switch(!n&&t&&(n=p&&d?p/d:1),this.isLimited&&(f=l.minLeft,v=l.minTop,x=f+xt(r.width,h.left+h.width),w=v+xt(r.height,h.top+h.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},n&&(s.X=s.y*n,s.Y=s.x/n),o){case pt:c+=s.x,u+=s.y;break;case et:if(s.x>=0&&(g>=x||n&&(v>=u||m>=w))){b=!1;break}p+=s.x,n&&(d=p/n,u-=s.Y/2),0>p&&(o=st,p=0);break;case nt:if(s.y<=0&&(v>=u||n&&(f>=c||g>=x))){b=!1;break}d-=s.y,u+=s.y,n&&(p=d*n,c+=s.X/2),0>d&&(o=at,d=0);break;case st:if(s.x<=0&&(f>=c||n&&(v>=u||m>=w))){b=!1;break}p-=s.x,c+=s.x,n&&(d=p/n,u+=s.Y/2),0>p&&(o=et,p=0);break;case at:if(s.y>=0&&(m>=w||n&&(f>=c||g>=x))){b=!1;break}d+=s.y,n&&(p=d*n,c-=s.X/2),0>d&&(o=nt,d=0);break;case ht:if(n){if(s.y<=0&&(v>=u||g>=x)){b=!1;break}d-=s.y,u+=s.y,p=d*n}else s.x>=0?x>g?p+=s.x:s.y<=0&&v>=u&&(b=!1):p+=s.x,s.y<=0?u>v&&(d-=s.y,u+=s.y):(d-=s.y,u+=s.y);0>p&&0>d?(o=rt,d=0,p=0):0>p?(o=lt,p=0):0>d&&(o=ot,d=0);break;case lt:if(n){if(s.y<=0&&(v>=u||f>=c)){b=!1;break}d-=s.y,u+=s.y,p=d*n,c+=s.X}else s.x<=0?c>f?(p-=s.x,c+=s.x):s.y<=0&&v>=u&&(b=!1):(p-=s.x,c+=s.x),s.y<=0?u>v&&(d-=s.y,u+=s.y):(d-=s.y,u+=s.y);0>p&&0>d?(o=ot,d=0,p=0):0>p?(o=ht,p=0):0>d&&(o=rt,d=0);break;case rt:if(n){if(s.x<=0&&(f>=c||m>=w)){b=!1;break}p-=s.x,c+=s.x,d=p/n}else s.x<=0?c>f?(p-=s.x,c+=s.x):s.y>=0&&m>=w&&(b=!1):(p-=s.x,c+=s.x),s.y>=0?w>m&&(d+=s.y):d+=s.y;0>p&&0>d?(o=ht,d=0,p=0):0>p?(o=ot,p=0):0>d&&(o=lt,d=0);break;case ot:if(n){if(s.x>=0&&(g>=x||m>=w)){b=!1;break}p+=s.x,d=p/n}else s.x>=0?x>g?p+=s.x:s.y>=0&&m>=w&&(b=!1):p+=s.x,s.y>=0?w>m&&(d+=s.y):d+=s.y;0>p&&0>d?(o=lt,d=0,p=0):0>p?(o=rt,p=0):0>d&&(o=ht,d=0);break;case ct:this.move(s.x,s.y),b=!1;break;case ut:this.zoom(function(t,i,e,s){var a=kt(t*t+i*i),n=kt(e*e+s*s);return(n-a)/a}(bt(this.startX-this.startX2),bt(this.startY-this.startY2),bt(this.endX-this.endX2),bt(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case dt:if(!s.x||!s.y){b=!1;break}e=this.$cropper.offset(),c=this.startX-e.left,u=this.startY-e.top,p=l.minWidth,d=l.minHeight,s.x>0?o=s.y>0?ot:ht:s.x<0&&(c-=p,o=s.y>0?rt:lt),s.y<0&&(u-=d),this.isCropped||(this.$cropBox.removeClass($),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}b&&(l.width=p,l.height=d,l.left=c,l.top=u,this.action=o,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(P),this.$cropBox.removeClass($)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(P),this.$cropBox.addClass($))},replace:function(t,i){!this.isDisabled&&t&&(this.isImg&&this.$element.attr("src",t),i?(this.url=t,this.$clone.attr("src",t),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(M))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(M))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass($)):this.isImg?t.off(H,this.start):this.$clone&&this.$clone.remove(),t.removeData(D)},move:function(t,i){var s=this.canvas;this.moveTo(e(t)?t:s.left+vt(t),e(i)?i:s.top+vt(i))},moveTo:function(t,s){var a=this.canvas,n=!1;e(s)&&(s=t),t=vt(t),s=vt(s),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(a.left=t,n=!0),i(s)&&(a.top=s,n=!0),n&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=vt(t),t=0>t?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,s,a,n,o,r=this.options,h=this.canvas,l=h.width,p=h.height,d=h.naturalWidth,u=h.naturalHeight;if(t=vt(t),t>=0&&this.isBuilt&&!this.isDisabled&&r.zoomable){if(s=d*t,a=u*t,i&&(e=i.originalEvent),this.trigger(q,{originalEvent:e,oldRatio:l/d,ratio:s/d}).isDefaultPrevented())return;e?(n=this.$cropper.offset(),o=e.touches?c(e.touches):{pageX:i.pageX||e.pageX||0,pageY:i.pageY||e.pageY||0},h.left-=(s-l)*((o.pageX-n.left-h.left)/l),h.top-=(a-p)*((o.pageY-n.top-h.top)/p)):(h.left-=(s-l)/2,h.top-=(a-p)/2),h.width=s,h.height=a,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+vt(t))},rotateTo:function(t){t=vt(t),i(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,s){var a=this.image,n=!1;e(s)&&(s=t),t=vt(t),s=vt(s),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(a.scaleX=t,n=!0),i(s)&&(a.scaleY=s,n=!0),n&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,s,a=this.options,n=this.image,o=this.canvas,r=this.cropBox;return this.isBuilt&&this.isCropped?(s={x:r.left-o.left,y:r.top-o.top,width:r.width,height:r.height},e=n.width/n.naturalWidth,t.each(s,function(t,a){a/=e,s[t]=i?It(a):a})):s={x:0,y:0,width:0,height:0},a.rotatable&&(s.rotate=n.rotate||0),a.scalable&&(s.scaleX=n.scaleX||1,s.scaleY=n.scaleY||1),s},setData:function(e){var s,a,n,o=this.options,r=this.image,h=this.canvas,l={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(o.rotatable&&i(e.rotate)&&e.rotate!==r.rotate&&(r.rotate=e.rotate,this.isRotated=s=!0),o.scalable&&(i(e.scaleX)&&e.scaleX!==r.scaleX&&(r.scaleX=e.scaleX,a=!0),i(e.scaleY)&&e.scaleY!==r.scaleY&&(r.scaleY=e.scaleY,a=!0)),s?this.renderCanvas():a&&this.renderImage(),n=r.width/r.naturalWidth,i(e.x)&&(l.left=e.x*n+h.left),i(e.y)&&(l.top=e.y*n+h.top),i(e.width)&&(l.width=e.width*n),i(e.height)&&(l.height=e.height*n),this.setCropBoxData(l))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,s){e[s]=i[s]}),e},setCanvasData:function(e){var s=this.canvas,a=s.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(s.left=e.left),i(e.top)&&(s.top=e.top),i(e.width)?(s.width=e.width,s.height=e.width/a):i(e.height)&&(s.height=e.height,s.width=e.height*a),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var s,a,n=this.cropBox,o=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(n.left=e.left),i(e.top)&&(n.top=e.top),i(e.width)&&(s=!0,n.width=e.width),i(e.height)&&(a=!0,n.height=e.height),o&&(s?n.height=n.width/o:a&&(n.width=n.height*o)),this.renderCropBox())},getCroppedCanvas:function(i){var e,s,a,n,o,r,h,l,p,c,u;return this.isBuilt&&mt?this.isCropped?(t.isPlainObject(i)||(i={}),u=this.getData(),e=u.width,s=u.height,l=e/s,t.isPlainObject(i)&&(o=i.width,r=i.height,o?(r=o/l,h=o/e):r&&(o=r*l,h=r/s)),a=Bt(o||e),n=Bt(r||s),p=t("<canvas>")[0],p.width=a,p.height=n,c=p.getContext("2d"),i.fillColor&&(c.fillStyle=i.fillColor,c.fillRect(0,0,a,n)),c.drawImage.apply(c,function(){var t,i,a,n,o,r,l=d(this.$clone[0],this.image),p=l.width,c=l.height,g=this.canvas,m=[l],f=u.x+g.naturalWidth*(bt(u.scaleX||1)-1)/2,v=u.y+g.naturalHeight*(bt(u.scaleY||1)-1)/2;return-e>=f||f>p?f=t=a=o=0:0>=f?(a=-f,f=0,t=o=xt(p,e+f)):p>=f&&(a=0,t=o=xt(e,p-f)),0>=t||-s>=v||v>c?v=i=n=r=0:0>=v?(n=-v,v=0,i=r=xt(c,s+v)):c>=v&&(n=0,i=r=xt(s,c-v)),m.push(Bt(f),Bt(v),Bt(t),Bt(i)),h&&(a*=h,n*=h,o*=h,r*=h),o>0&&r>0&&m.push(Bt(a),Bt(n),Bt(o),Bt(r)),m}.call(this)),p):d(this.$clone[0],this.image):void 0},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=wt(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i=t===dt,e=s.movable&&t===ct,t=i||e?t:gt,this.$dragBox.data(it,t).toggleClass(T,i).toggleClass(L,e),s.cropBoxMovable||this.$face.data(it,t).toggleClass(T,i).toggleClass(L,e))}},v.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},v.setDefaults=function(i){t.extend(v.DEFAULTS,i)},v.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',v.other=t.fn.cropper,t.fn.cropper=function(i){var a,n=s(arguments,1);return this.each(function(){var e,s,o=t(this),r=o.data(D);if(!r){if(/destroy/.test(i))return;e=t.extend({},o.data(),t.isPlainObject(i)&&i),o.data(D,r=new v(this,e))}"string"==typeof i&&t.isFunction(s=r[i])&&(a=s.apply(r,n))}),e(a)?this:a},t.fn.cropper.Constructor=v,t.fn.cropper.setDefaults=v.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=v.other,this}});var ILabCrop=function(t,i){this.settings=i,this.modalContainer=t("#ilabm-container-"+i.modal_id),this.cropper=this.modalContainer.find(".ilabc-cropper"),this.cropperData={},this.modal_id=i.modal_id;var e,s=this,a=!1;this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:this.settings.size,tabSelected:function(t){ILabModal.loadURL(t.data("url"),!0,function(t){console.log(t),s.bindUI(t)})}}),t(window).resize(function(){a||(data=s.cropper.cropper("getData"),s.settings.prev_crop_x=data.x,s.settings.prev_crop_y=data.y,s.settings.prev_crop_width=data.width,s.settings.prev_crop_height=data.height),a=!0,s.updatePreviewWidth(),clearTimeout(e),e=setTimeout(s._resized,250)}),this.modalContainer.find(".ilabc-button-crop").on("click",function(t){return t.preventDefault(),s.crop(),!1}),this._resized=function(){s.bindUI(s.settings),a=!1},this.updatePreviewWidth=function(){var t=this.modalContainer.find(".ilab-crop-preview-title").width();this.modalContainer.find(".ilab-crop-preview").css({height:t/s.settings.aspect_ratio+"px",width:t+"px"})},this.bindUI=function(t){this.settings=t,this.cropper.cropper("destroy"),this.cropper.off("built.cropper"),t.hasOwnProperty("cropped_src")&&null!==t.cropped_src&&this.modalContainer.find(".ilab-current-crop-img").attr("src",t.cropped_src),t.hasOwnProperty("size_title")&&null!==t.size_title&&this.modalContainer.find(".ilabc-crop-size-title").text("Current "+t.size_title+" ("+t.min_width+" x "+t.min_height+")"),"undefined"!=typeof t.aspect_ratio&&(this.updatePreviewWidth(),"undefined"!=typeof t.prev_crop_x&&null!==t.prev_crop_x&&(this.cropperData={x:t.prev_crop_x,y:t.prev_crop_y,width:t.prev_crop_width,height:t.prev_crop_height},console.log(this.cropperData)),this.cropper.on("built.cropper",function(){s.updatePreviewWidth()}).on("crop.cropper",function(t){}).cropper({viewMode:1,aspectRatio:t.aspect_ratio,minWidth:t.min_width,minHeight:t.min_height,modal:!0,zoomable:!1,mouseWheelZoom:!1,dragCrop:!1,autoCropArea:1,movable:!1,data:this.cropperData,checkImageOrigin:!1,checkCrossOrigin:!1,responsive:!0,preview:"#ilabm-container-"+this.modal_id+" .ilab-crop-preview"}))},this.crop=function(){var t=this;this.displayStatus("Saving crop ...");var i=this.cropper.cropper("getData");i.action="ilab_perform_crop",i.post=this.settings.image_id,i.size=this.settings.size,jQuery.post(ajaxurl,i,function(i){console.log(i),"ok"==i.status?(t.modalContainer.find(".ilab-current-crop-img").one("load",function(){t.hideStatus()}),t.modalContainer.find(".ilab-current-crop-img").attr("src",i.src)):t.hideStatus()})},this.displayStatus=function(t){s.modalContainer.find(".ilabm-status-label").text(t),s.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){s.modalContainer.find(".ilabm-status-container").addClass("is-hidden")},this.bindUI(i)},ImgixComponents=function(){var t=function(t){var i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];return i[t>>4&15]+i[15&t]};return{utilities:{byteToHex:t}}}();!function(t){t.fn.imgixLabel=function(i){var e=t.extend({},i);return this.each(function(){var i,s=t(this),a=0,n=t('<input type="text" class="imgix-label-editor is-hidden" pattern="[0-9-]+">');s.parent().append(n),n.on("keydown",function(t){if(27==t.keyCode)n.off("blur"),n.off("input"),n.addClass("is-hidden"),e.hasOwnProperty("changed")&&e.changed(a),s.text(a);else if(13==t.keyCode){n.off("blur"),n.off("input");var i=parseInt(n.val());n.addClass("is-hidden"),e.hasOwnProperty("changed")&&e.changed(i),s.text(i)}else if(38==t.keyCode){var i=parseInt(n.val());i++,n.val(i),e.hasOwnProperty("changed")&&e.changed(i),s.text(i)}else{if(40!=t.keyCode)return t.keyCode<57?!0:t.keyCode>90&&t.keyCode<105?!0:109==t.keyCode?!0:t.metaKey?!0:(t.preventDefault(),!1);var i=parseInt(n.val());i--,n.val(i),e.hasOwnProperty("changed")&&e.changed(i),s.text(i)}}),s.on("click",function(t){return t.preventDefault(),n.on("input",function(){var t=parseInt(n.val());e.hasOwnProperty("changed")&&(clearTimeout(i),i=setTimeout(function(){e.changed(t)},500)),s.text(t)}),n.on("blur",function(){var t=parseInt(n.val());n.addClass("is-hidden"),e.hasOwnProperty("changed")&&e.changed(t),s.text(t)}),a=e.hasOwnProperty("currentValue")?e.currentValue():0,
n.val(a),n.removeClass("is-hidden"),n.select(),n.focus(),!1})})}}(jQuery),function(t){ImgixComponents.ImgixSlider=function(t,i){this.delegate=t,this.container=i,this.valueLabel=i.find(".imgix-param-title-right > h3"),this.slider=i.find(".imgix-param"),this.resetButton=i.find(".imgix-param-reset"),this.defaultValue=i.data("default-value"),this.param=i.data("param");var e=this;this.container.find(".imgix-param-label").imgixLabel({currentValue:function(){return e.slider.val()},changed:function(t){t!=e.slider.val()&&(e.slider.val(t),e.slider.hide().show(0),e.delegate.preview())}}),this.resetButton.on("click",function(){e.reset()}),this.slider.on("input",function(){e.valueLabel.text(e.slider.val())}),this.slider.on("change",function(){e.valueLabel.text(e.slider.val()),e.delegate.preview()})},ImgixComponents.ImgixSlider.prototype.destroy=function(){this.slider.off("input"),this.slider.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixSlider.prototype.reset=function(t){var i;i=t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,this.valueLabel.text(i),this.slider.val(i),this.slider.hide().show(0),this.delegate.preview()},ImgixComponents.ImgixSlider.prototype.saveValue=function(t){return this.slider.val()!=this.defaultValue&&(t[this.param]=this.slider.val()),t}}(jQuery),function(t){ImgixComponents.ImgixColor=function(t,i){this.delegate=t,this.container=i,this.colorPicker=i.find(".imgix-param-color"),this.alphaSlider=i.find(".imgix-param-alpha"),this.type=i.data("param-type"),this.resetButton=i.find(".imgix-param-reset"),this.param=i.data("param"),this.defaultValue=i.data("default-value");var e=this;if("blend-color"==this.type){this.blendParam=i.data("blend-param"),this.blendSelect=i.find(".imgix-param-blend");var s=i.data("blend-value");this.blendSelect.val(s),this.blendSelect.on("change",function(){e.delegate.preview()})}this.colorPicker.wpColorPicker({palettes:!1,change:function(t,i){e.delegate.preview()}}),this.alphaSlider.on("change",function(){e.delegate.preview()}),this.resetButton.on("click",function(){e.reset()})},ImgixComponents.ImgixColor.prototype.destroy=function(){this.alphaSlider.off("change"),"blend-color"==this.type&&this.blendSelect.off("change"),this.resetButton.off("click")},ImgixComponents.ImgixColor.prototype.reset=function(t){var i,e="none";if(console.log(t),void 0!==t&&t.hasOwnProperty(this.blendParam)&&(e=t[this.blendParam]),i=void 0!==t&&t.hasOwnProperty(this.param)?t[this.param]:this.defaultValue,console.log("dagu"),console.log(i),i=i.replace("#",""),8==i.length){var s=parseInt("0x"+i.substring(0,2))/255*100;i=i.substring(2),this.alphaSlider.val(Math.round(s)),this.alphaSlider.hide().show(0)}else this.alphaSlider.val(0),this.alphaSlider.hide().show(0);this.colorPicker.val("#"+i),this.colorPicker.wpColorPicker("color","#"+i),"blend-color"==this.type&&this.blendSelect.val(e),this.delegate.preview()},ImgixComponents.ImgixColor.prototype.saveValue=function(t){return this.alphaSlider.val()>0&&(t[this.param]="#"+ImgixComponents.utilities.byteToHex(Math.round(parseFloat(this.alphaSlider.val())/100*255))+this.colorPicker.val().replace("#",""),"blend-color"==this.type&&"none"!=this.blendSelect.val()&&(t[this.blendParam]=this.blendSelect.val())),t}}(jQuery),function(t){ImgixComponents.ImgixAlignment=function(i,e){this.delegate=i,this.container=e,this.alignmentParam=e.find(".imgix-param"),this.resetButton=e.find(".imgix-param-reset"),this.defaultValue=e.data("default-value"),this.param=e.data("param");var s=this;this.resetButton.on("click",function(){s.reset()}),e.find(".imgix-alignment-button").on("click",function(){var i=t(this);s.container.find(".imgix-alignment-button").each(function(){t(this).removeClass("selected-alignment")}),i.addClass("selected-alignment"),s.alignmentParam.val(i.data("param-value")),s.delegate.preview()})},ImgixComponents.ImgixAlignment.prototype.destroy=function(){this.resetButton.off("click"),this.container.find(".imgix-alignment-button").off("click")},ImgixComponents.ImgixAlignment.prototype.reset=function(i){var e;e=i&&i.hasOwnProperty(this.param)?i[this.param]:this.defaultValue,""==e&&(e=this.defaultValue),this.container.find(".imgix-alignment-button").each(function(){var i=t(this);i.data("param-value")==e?i.addClass("selected-alignment"):i.removeClass("selected-alignment")}),this.alignmentParam.val(e),this.delegate.preview()},ImgixComponents.ImgixAlignment.prototype.saveValue=function(t){return this.alignmentParam.val()!=this.defaultValue&&(t[this.param]=this.alignmentParam.val()),t}}(jQuery),function(t){ImgixComponents.ImgixMediaChooser=function(t,i){this.delegate=t,this.container=i,this.preview=i.find(".imgix-media-preview img"),this.mediaInput=i.find(".imgix-param"),this.selectButton=i.find(".imgix-media-button"),this.resetButton=i.find(".imgix-param-reset"),this.defaultValue=i.data("default-value"),this.param=i.data("param"),this.uploader=wp.media({title:"Select Watermark",button:{text:"Select Watermark"},multiple:!1});var e=this;this.resetButton.on("click",function(){e.reset()}),this.uploader.on("select",function(){attachment=e.uploader.state().get("selection").first().toJSON(),e.mediaInput.val(attachment.id),e.preview.attr("src",attachment.url),e.delegate.preview()}),this.selectButton.on("click",function(t){return t.preventDefault(),e.uploader.open(),!1})},ImgixComponents.ImgixMediaChooser.prototype.destroy=function(){this.selectButton.off("click"),this.uploader.off("select"),this.resetButton.off("click")},ImgixComponents.ImgixMediaChooser.prototype.reset=function(t){var i;t&&t.hasOwnProperty(this.param)?(i=t[this.param],this.mediaInput.val(i)):this.mediaInput.val(""),t&&t.hasOwnProperty(this.param+"_url")?this.preview.attr("src",t[this.param+"_url"]):(this.preview.removeAttr("src").replaceWith(this.preview.clone()),this.preview=this.container.find(".imgix-media-preview img")),this.delegate.preview()},ImgixComponents.ImgixMediaChooser.prototype.saveValue=function(t){var i=this.mediaInput.val();return i&&""!=i&&(t[this.param]=i),t}}(jQuery),function(t){ImgixComponents.ImgixPillbox=function(i,e){this.delegate=i,this.container=e,this.param=e.data("param"),this.values=e.data("param-values").split(","),this.buttons=e.find(".ilabm-pill"),this.inputs={};var s=this;this.buttons.each(function(){var i=t(this),e=i.data("param");s.inputs[e]=s.container.find("input[name='"+e+"']"),i.on("click",function(t){return t.preventDefault(),0==s.inputs[e].val()?(s.inputs[e].val(1),i.addClass("pill-selected")):(s.inputs[e].val(0),i.removeClass("pill-selected")),s.delegate.preview(),!1})})},ImgixComponents.ImgixPillbox.prototype.destroy=function(){this.buttons.off("click")},ImgixComponents.ImgixPillbox.prototype.reset=function(i){this.buttons.each(function(){t(this).removeClass("pill-selected")});var e=this;if(Object.keys(this.inputs).forEach(function(t,i){e.inputs[t].val(0)}),i&&i.hasOwnProperty(this.param)){var s=i[this.param].split(",");s.forEach(function(t,i){e.inputs[t].val(1),e.container.find("imgix-pill-"+t).addClass("pill-selected")})}this.delegate.preview()},ImgixComponents.ImgixPillbox.prototype.saveValue=function(t){var i=[],e=this;return Object.keys(this.inputs).forEach(function(t,s){1==e.inputs[t].val()&&i.push(t)}),i.length>0&&(t[this.param]=i.join(",")),t}}(jQuery);var ILabImgixPresets=function(t,i,e){this.delegate=i,this.container=e.find(".ilabm-bottom-bar"),this.presetSelect=this.container.find(".imgix-presets"),this.presetContainer=this.container.find(".imgix-preset-container"),this.presetDefaultCheckbox=this.container.find(".imgix-preset-make-default");var s=this;s.presetSelect.on("change",function(){if(0==s.presetSelect.val)return s.delegate.resetAll(),void s.presetDefaultCheckbox.prop("checked",!1);var t=s.delegate.settings.presets[s.presetSelect.val()];t.default_for==s.delegate.settings.size&&s.presetDefaultCheckbox.prop("checked",!0),s.delegate.bindPreset(t)}),this.container.find(".imgix-new-preset-button").on("click",function(){s.newPreset()}),this.container.find(".imgix-save-preset-button").on("click",function(){s.savePreset()}),this.container.find(".imgix-delete-preset-button").on("click",function(){s.deletePreset()}),this.init=function(){s.presetSelect.find("option").remove(),0==Object.keys(s.delegate.settings.presets).length?s.presetContainer.addClass("is-hidden"):(Object.keys(s.delegate.settings.presets).forEach(function(i,e){console.log(i),s.presetSelect.append(t("<option></option>").attr("value","0").text("None")),s.presetSelect.append(t("<option></option>").attr("value",i).text(s.delegate.settings.presets[i].title))}),s.presetContainer.removeClass("is-hidden"),s.presetSelect.val(s.delegate.settings.currentPreset))},this.clearSelected=function(){s.presetSelect.val(0),s.presetDefaultCheckbox.prop("checked",!1)},this.setCurrentPreset=function(t,i){i?s.presetDefaultCheckbox.prop("checked",!0):s.presetDefaultCheckbox.prop("checked",!1),s.presetSelect.val(t)},this.newPreset=function(){var t=prompt("New preset name");if(null!=t){s.delegate.displayStatus("Saving preset ...");var i={};i.name=t,s.presetDefaultCheckbox.is(":checked")&&(i.make_default=1),s.delegate.postAjax("ilab_imgix_new_preset",i,function(t){s.delegate.hideStatus(),"ok"==t.status&&(s.delegate.settings.currentPreset=t.currentPreset,s.delegate.settings.presets=t.presets,s.init())})}},this.savePreset=function(){if(null!=s.presetSelect.val()){s.delegate.displayStatus("Saving preset ...");var t={};t.key=s.presetSelect.val(),s.presetDefaultCheckbox.is(":checked")&&(t.make_default=1),s.delegate.postAjax("ilab_imgix_save_preset",t,function(t){s.delegate.hideStatus()})}},this.deletePreset=function(){if(null!=s.presetSelect.val()&&confirm("Are you sure you want to delete this preset?")){s.delegate.displayStatus("Delete preset ...");var t={};t.key=s.presetSelect.val(),s.delegate.postAjax("ilab_imgix_delete_preset",t,function(t){s.delegate.hideStatus(),"ok"==t.status&&(s.delegate.settings.currentPreset=t.currentPreset,s.delegate.settings.presets=t.presets,s.init(),s.delegate.bindUI(t))})}},this.init()};!function(t){t.fn.ilabSidebarTabs=function(i){var e=t.extend({},i),s=!1;return this.find(".ilabm-sidebar-tab").each(function(){var i=t(this),a=e.container.find("."+i.data("target"));s||(i.addClass("active-tab"),a.removeClass("is-hidden"),s=!0),i.on("click",function(s){return s.preventDefault(),e.container.find(".ilabm-sidebar-tab").each(function(){var i=t(this),s=e.container.find("."+i.data("target"));i.removeClass("active-tab"),s.addClass("is-hidden")}),i.addClass("active-tab"),a.removeClass("is-hidden"),!1})})}}(jQuery);var ILabImageEdit=function(t,i){function e(){s.displayStatus("Building preview ..."),s.waitModal.removeClass("is-hidden"),s.postAjax("ilab_imgix_preview",{},function(t){"ok"==t.status?(s.settings.debug&&console.log(t.src),s.previewImage.on("load",function(){s.waitModal.addClass("is-hidden"),s.hideStatus()}),s.previewImage.attr("src",t.src)):(s.waitModal.addClass("is-hidden"),s.hideStatus())})}console.log(i),this.previewTimeout=null,this.previewsSuspended=!1,this.parameters=[];var s=this;this.settings=i,this.modalContainer=t("#ilabm-container-"+i.modal_id),this.waitModal=this.modalContainer.find(".ilabm-preview-wait-modal"),this.previewImage=this.modalContainer.find(".imgix-preview-image"),this.presets=new ILabImgixPresets(t,this,this.modalContainer),this.modalContainer.find(".imgix-button-reset-all").on("click",function(){s.resetAll()}),this.modalContainer.find(".imgix-button-save-adjustments").on("click",function(){s.apply()}),this.modalContainer.find(".imgix-parameter").each(function(){var i=t(this),e=i.data("param-type");"slider"==e?s.parameters.push(new ImgixComponents.ImgixSlider(s,i)):"color"==e||"blend-color"==e?s.parameters.push(new ImgixComponents.ImgixColor(s,i)):"pillbox"==e?s.parameters.push(new ImgixComponents.ImgixPillbox(s,i)):"media-chooser"==e?s.parameters.push(new ImgixComponents.ImgixMediaChooser(s,i)):"alignment"==e&&s.parameters.push(new ImgixComponents.ImgixAlignment(s,i))}),this.modalContainer.on("click",".imgix-pill",function(){var i=t(this).data("param"),e=s.modalContainer.find("#imgix-param-"+i);1==e.val()?(e.val(0),t(this).removeClass("pill-selected")):(e.val(1),t(this).addClass("pill-selected")),s.preview()}),this.modalContainer.find(".ilabm-editor-tabs").ilabTabs({currentValue:s.settings.size,tabSelected:function(t){ILabModal.loadURL(t.data("url"),!0,function(t){console.log(t),s.bindUI(t)})}}),this.modalContainer.find(".ilabm-sidebar-tabs").ilabSidebarTabs({delegate:this,container:this.modalContainer}),this.postAjax=function(i,e,a){var n={};s.parameters.forEach(function(t,i){n=t.saveValue(n)}),console.log(n),e.image_id=s.settings.image_id,e.action=i,e.size=s.settings.size,e.settings=n,t.post(ajaxurl,e,a)},this.preview=function(){s.previewsSuspended||(ILabModal.makeDirty(),clearTimeout(s.previewTimeout),s.previewTimeout=setTimeout(e,500))},this.bindUI=function(t){if(t.hasOwnProperty("currentPreset")&&null!=t.currentPreset&&""!=t.currentPreset){var i=s.settings.presets[t.currentPreset];s.presets.setCurrentPreset(t.currentPreset,i.default_for==t.size)}else s.presets.clearSelected();s.previewsSuspended=!0,s.settings.size=t.size,s.settings.settings=t.settings;var e=function(){s.previewImage.off("load",e),s.parameters.forEach(function(i,e){i.reset(t.settings)}),s.previewsSuspended=!1,ILabModal.makeClean()};t.src?(s.previewImage.on("load",e),s.previewImage.attr("src",t.src)):e()},this.bindPreset=function(t){console.log(t),s.previewsSuspended=!0,s.settings.settings=t.settings,s.previewImage.off("load"),s.parameters.forEach(function(t,i){t.reset(s.settings.settings)}),s.previewsSuspended=!1,s.preview()},this.apply=function(){s.displayStatus("Saving adjustments ..."),s.postAjax("ilab_imgix_save",{},function(t){s.hideStatus(),ILabModal.makeClean()})},this.resetAll=function(){s.parameters.forEach(function(t,i){t.reset()})},this.displayStatus=function(t){s.modalContainer.find(".ilabm-status-label").text(t),s.modalContainer.find(".ilabm-status-container").removeClass("is-hidden")},this.hideStatus=function(){s.modalContainer.find(".ilabm-status-container").addClass("is-hidden")}};
//# sourceMappingURL=ilab-media-tools.js.map
